#!/bin/bash

export PI_CMD="${0}"
DIR="$(dirname "${PI_CMD}")"
export PATH="${DIR}:${PATH}"
PDIR="$(dirname "${DIR}")
export PI_INCLUDE="${PDIR}/inc"
. "${PI_INCLUDE}/msgs.sh


NAME="${1-pi:build}"
shift

echo "Creating Raspberry Pi image ${PI_IMAGE_FILE} from docker container ${NAME}"
echo "This will take some time."

docker export "${NAME}" - | rpi-image-tool create-image "${@}" || error "Image load failed"
