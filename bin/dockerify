#!/bin/bash

# Produce a .tar file suitable for the docker import command.
#  usage: rpi-image-tool rpi-distro.img dockerify rpi-distro.tar

case "$1" in
    --help)
        (
            echo "Export a tar file for import with the docker import command."
            echo "Usage ${INVOKER} $(basename "$0") [outfile]"
        )1>&2
        exit 0
        ;;
esac


EXCLUDE=("dev/*" "proc/*" "sys/*" "tmp/*" "run/*" "mnt/*" "media/*" "lost+found")
EXCLUDES=()
for E in "${EXCLUDE[@]}"; do
    EXCLUDES+=(--exclude "${E}")
done

DFLT="$(basename $IMG .img).tar"

OUT="${1-$DFLT}"
shift


tar --create --file "${OUT}" "${EXCLUDES[@]}" -C "${ROOTDIR}" --checkpoint=5000 --checkpoint-action='echo=%u %T%*\r' .
